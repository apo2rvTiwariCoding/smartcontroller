-- ASE Smart controller MysSQL database structure
-- Version 1.00.40 from 13 December 2014

-- Description of table cots_data:
-- stores customer thermostat (nest) data, like temperature, humidity, online status, etc
--
-- id		- unique record ID
-- cots_id	- COTS ID
-- updated	- date and time of last value update
-- name_	- record name
-- value_	- record value
--
CREATE TABLE `cots_data` (
  `id` int(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `cots_id` int(11) DEFAULT NULL,
  `updated` datetime DEFAULT NULL,
  `name_` varchar(50) DEFAULT NULL,
  `value_` varchar(100) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 PACK_KEYS=0;

-- Description of table smartstatus:
-- stores current Smart Controller network and system health (CPU, RAM, etc) status
--
-- id		- unique record ID
-- updated	- date and time of last value update
-- group_	- record group:
--		  health = system health group
--		  network = IP network status values
-- name		- record name
-- value	- record value
--
CREATE TABLE `smartstatus` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime NOT NULL,
  `group` varchar(50) NOT NULL,
  `name` varchar(50) NOT NULL,
  `value` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 PACK_KEYS=0;

-- Description of table users:
-- stores ASE RertoSave customer information
--
-- id		- unique local system userID
-- login        - username, unique for smart controller. unique for cloud when combined with dbid
--                default user/password pairs for smart controller :
--                aseuser/aseuser - user with low access rights (view only)
-- password     - password for corresponding username
-- name1	- first name
-- name2	- last name
-- address1	- address line 1
-- address2	- address line 2
-- city		- city/town
-- province	- state/province
-- country	- country
-- postal	- postal code or ZIP
-- phone1	- phone number, main
-- phone2	- phone number, mobile/secondary
-- phone3	- phone number, additional
-- email	- email address (may be used as web UI login username)
-- timezone	- time zone relative to UTC :
--		  0 = GMT timezone
--		  -1200 = GMT-12, International Date Line West
--		  1100 = GMT+12, Fiji, Kamchatka
--		  530 = GMT+05:30, New Dehli
-- comfort	- comfort slider settings (0 - 4):
--		  0 = Max saving
--		  4 = Max comfort
-- access	- access mode. 0 - user, 1 - administrator, 2 - superadmin (cloud root access)
-- t_display	- temperature display. 0 - Celsius, 1 - Fahrenheit
--
CREATE TABLE `users` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `login` varchar(50) NOT NULL,
  `password` varchar(50) NOT NULL,
  `name1` varchar(100) NOT NULL,
  `name2` varchar(100) DEFAULT NULL,
  `address1` varchar(200) DEFAULT NULL,
  `address2` varchar(200) DEFAULT NULL,
  `city` varchar(100) DEFAULT NULL,
  `province` varchar(100) DEFAULT NULL,
  `country` varchar(100) DEFAULT NULL,
  `postal` varchar(20) DEFAULT NULL,
  `phone1` varchar(20) NOT NULL,
  `phone2` varchar(20) DEFAULT NULL,
  `phone3` varchar(20) DEFAULT NULL,
  `email` varchar(200) NOT NULL,
  `timezone` smallint(6) NOT NULL DEFAULT '0',
  `comfort` tinyint(4) NOT NULL DEFAULT '0',
  `access` tinyint(4) NOT NULL DEFAULT '0',
  `t_display` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`),
  UNIQUE KEY `login` (`login`),
  UNIQUE KEY `password` (`password`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table registrations:
-- stores detailed log of all zigbee network device registration events
--
-- id		- unique device registration ID
-- updated	- device registration date and time
-- event_type	- registration even type:
--		  0 = Deletion of a zigbee device previously added to the smart controller database
--		  1 = Addition of a new zigbee device to the smart controller database
--		  2 = Update the ASEMP profile of the remote device
--		  3 = Update the status of the remote device
--		  4 = Update the zigbee short address of the remote device
--		  5 = Registration request from new device
-- device_type	- Remote Device Type:
--		  0 = ASEMP device
--		  80 = 3rd party Zigbee device
--		999 = adhoc_mode_remote_device_type_delimiter - virtual device used in adhoc mode to create next zone (code TBD)
-- zigbee_short	- remote Zigbee short address
-- zigbee_addr64 - Mac address of remote zigbee radio
-- zigbee_mode	- Remote Zigbee mode:
--		  0 = coordinator
--		  1 = router
--		  2 = end device
-- panid	- PAN ID set by the coordinator (16 bits)
-- channel	- Operating RF channel mask of the coordinator. based on table from zigbee config 
-- rssi		- Remote device RX Signal strength
-- device_id	- Assigned Device ID, referred to DB Devices table. 
--		  Automatically generated by the smart controller software when a new zigbee device is added to the database
--		  0 = coordinator
-- device_desc	- Device nickname/description. Entered by the user or admin (optional)
-- zone_id	- Assigned Zone ID, referred to DB Zones table. 
--		  Automatically generated  by the smart controller software. 
--		  Devices can be assigned to zone IDs manually by the admin, or automatically if ADHOC mode of installation is enabled in the database.
--		  1 = virtual zone (contains newly added but unassigned devices)
--		  2 = master zone (contains only master sensor)
--		 99 = unassigned
-- zone_desc	- Zone nickname/description. Entered by the user or admin
-- source	- Web UI source address. IP address of user/admin device. 0.0.0.0 implies the Magellan. 127.0.0.x implies the smart controller own UI
-- zigbee_hw	- Zigbee radio hardware version
-- zigbee_fw	- Zigbee radio firmware version
-- device_hw	- Device hardware version
-- device_fw	- Device software version
-- status	- Device status:
--		  0 = active, waiting for registration
--		  1 = inactive
--		  2 = registration accepted (for event type 1)
--		  3 = registration rejected (for event type 1)
--		  4 = device successfully de-registered from network
-- asemp_id	- ASEMP Profile ID. If there is one profile, the smart controller software automatically assigns this profile to the remote device. 
-- serial	- ASE remote device unique serial number
--
CREATE TABLE `registrations` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `event_type` int(11) DEFAULT NULL,
  `device_type` int(11) DEFAULT NULL,
  `zigbee_short` int(11) DEFAULT NULL,
  `zigbee_addr64` varchar(32) DEFAULT NULL,
  `zigbee_mode` int(11) DEFAULT NULL,
  `panid` int(11) DEFAULT NULL,
  `channel` int(11) DEFAULT NULL,
  `rssi` int(11) DEFAULT NULL,
  `device_id` int(11) DEFAULT NULL,
  `device_desc` varchar(255) DEFAULT NULL,
  `zone_id` int(11) DEFAULT NULL,
  `zone_desc` varchar(255) DEFAULT NULL,
  `source` int(11) DEFAULT '0',
  `zigbee_hw` int(11) DEFAULT NULL,
  `zigbee_fw` int(11) DEFAULT NULL,
  `device_hw` int(11) DEFAULT NULL,
  `device_fw` int(11) DEFAULT NULL,
  `status` int(11) DEFAULT '0',
  `asemp_id` int(11) DEFAULT NULL,
  `serial` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_types:
-- RetroSAVE Events/Alarms Enable/Disable List
--
-- id		- unique event/alarm ID in table
-- alarm_id	- event/alarm ID unique for it's type:
--		 -1 = alarms group description
-- type_	- alarm/event type:
--		  0 = RetroSAVE
--		  1 = Zigbee
--		  2 = System
--		  3 = Networks
--		  4 = Pressure
--		  5 = Registration of new remote devices
-- status	- alarm status:
--		  0 = disabled
--		  1 = enabled
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- description  - text entered by the admin via the web UI
--
CREATE TABLE `alarms_types` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `alarm_id` int(11) NOT NULL DEFAULT '0',
  `type_` int(11) NOT NULL DEFAULT '0',
  `status` tinyint(4) NOT NULL DEFAULT '1',
  `severity` tinyint(4) NOT NULL DEFAULT '0',
  `description` varchar(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_zigbee:
-- stores log of zigbee network alarms
--
-- id		- unique event/alarm ID
-- zone_id	- zone id to which device is assigned
-- device_id	- remote ID retrieved from the Devices DB table originally assigned when the zigbee devive was added to the smart controller config.
--		  device_id = 0 is dedicated to the smart controller
-- updated	- event/alarm date and time
-- panid	- current PAN ID used by the smart controller coordinator
-- addr64	- zigbee MAC address of the device that caused this alarm
-- address	- zigbee short address of the device that caused this alarm
-- rssi		- signal strength corresponding to zigbee short address
-- channel	- network channel used by the smart controller coordinator
-- type_	- alarm type:
--		  0 = zigbee device connected to smart controller network
--		  1 = loss of communication with remote device
--		  2 = PAN ID conflict. A new PAN ID is needed. PAN ID are automatically generated by the smart controller coordinator by scanning adjacent PAN IDs
--		  3 = PAN ID resolution. A new PAN ID has been generated by the smart controller coordinator. event also used to indicate PAN ID selected by low layer in AUTO mode
--		  4 = RF interference. A new RF channel needed. The Smart Controller will scan for the least noisy RF channel available
--		  5 = RF interference resolution. A new RF channel has been selected by the smart controller coordinator. event also used to indicate RF channel selected by low layer in AUTO mode
--		  6 = Radio module unsuccessful restart
--		  7 = Radio module successful restart
--		  8 = Unable to create new zigbee network with passed parameters
--		  9 = New Zigbee network successfully created
--		  10 = Existing Zigbee network parameters change error
--		  11 = Existing Zigbee network parameters successful change
--		  12 = Unable to change configuration mode
--		  13 = Configuration mode successfully enabled (new devices allowed to join)
--		  14 = Configuration mode successfully disabled (new devices disallowed to join)
--		  15 = Network discovery result
--		  16 = Ping remote device result
--		  17 = Route discovery result
--		  18 = non-ASE device command status
--		  19 = ASE device (ASEMP capable) command status
--		  20 = Unable to set ZED enable or disable status
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- description  - text entered by the admin via the web UI or comments added by event processing code
--
CREATE TABLE `alarms_zigbee` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `zone_id` int(11) DEFAULT NULL,
  `device_id` int(11) DEFAULT NULL,
  `updated` datetime DEFAULT NULL,
  `panid` int(11) DEFAULT NULL,
  `addr64` varchar(32) DEFAULT NULL,
  `address` int(11) DEFAULT NULL,
  `rssi` int(11) DEFAULT NULL,
  `channel` int(11) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_networks:
-- stores log of IP network events/alarms
--
-- id		- unique event/alarm ID
-- updated	- event/alarm date and time
-- ip		- internet server address to which the smart controller attempted to connect
-- type_	- alarm type:
--		  0 = connection was successful
--		  1 = first failed attempt to connect to ISP name server
--		  2 = consecutive failed attempts to connect to ISP name server
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- description  - text entered by the admin via the web UI
--
CREATE TABLE `alarms_networks` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `ip` varchar(20) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_pressure:
-- stores log of pressure events/alarms
--
-- id		- unique event/alarm ID
-- updated	- event/alarm date and time
-- pressure	- calculated static pressure. derived from the T1 and T2 temp probes on the smart controller
-- threshold	- static pressure threshold. set in the smart controller operational parameters table
-- type_	- alarm type:
--		  0 = Calculated static pressure below threshold
--		  1 = Calculated static pressure exceeded threshold for the first time
--		  2 = Consecutive Calculated static pressure values exceeded threshold
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- description  - text entered by the admin via the web UI
--
CREATE TABLE `alarms_pressure` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `pressure` int(11) DEFAULT NULL,
  `threshold` int(11) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_system:
-- stores log of smart controller system alarms
--
-- id		- unique event/alarm ID
-- updated	- event/alarm date and time
-- type_	- alarm type:
--		  0 = System update initiated by admin
--		  1 = DB max storage level reached
--		  2 = Smart controller board unsuccessful restart
--		  3 = Smart controller diagnostics result
--		  4 = set relays status error
--		  5 = onboard sensor read error
--		  6 = thermostat wires read error
--		  7 = unable to set RTC value
--		  8 = date and time received from RTC as unix timestamp
--		  9 = unable to get RTC value
--		 10 = local sensor set status error
--		 11 = RetroSAVE modules restart
--		 12 = Smart controller system reset
--		 13 = Smart controller shutdown
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- description  - text entered by the admin via the web UI
--
CREATE TABLE `alarms_system` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table alarms_retrosave:
-- stores log of Retrosave system alarms
--
-- id		- unique event/alarm ID
-- updated	- event/alarm date and time
-- type_	- alarm type:
--		  0 = Time based triggered period
--		  1 = PIR triggered report 
--		  2 = Battery Level triggered report
--		  3 = Upper temp Value Report Trigger
--		  4 = Lower temp Value Report Trigger
--		  5 = Upper Humidity Value Report Trigger 
--		  6 = Lower Humidity Value Report Trigger
--		  7 = Upper CO Value Trigger Report
--		  8 = Upper CO2 Value Trigger Report
--		  9 = ASEMP Central Command Request triggered report
--		 10 = Board power-up or reset triggered.
--		 11 = AC current Upper threshold triggered.
--		 12 = ADC2 threshold triggered.
--		 13 = ADC3 threshold triggered.
--		 14 = ADC4 threshold triggered.
--		 15 = CO_Aout ADC1 threshold triggered.
-- severity	- event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- zone_desc	- zone nickname (text description)
-- device_desc	- remote device nickname (text description)
--
CREATE TABLE `alarms_retrosave` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `severity` int(11) DEFAULT NULL,
  `zone_desc` varchar(100) DEFAULT NULL,
  `device_desc` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table bypass:
-- bypass switch events log
-- 
-- id		- unique event/alarm ID
-- updated	- event/alarm date and time
-- type_	- event type:
--		  0 = Bypass forced via toggle switch on smart controller
--		  1 = Bypass forced via the web UI
--		  2 = Bypass forced bia mobile app
-- status	- bypass mode status
--		  0 = Bypass mode Disabled
--		  1 = Bypass mode Enabled
-- description	- Text entered by the admin via the web UI
--
CREATE TABLE `bypass` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT '0',
  `status` int(11) DEFAULT '0',
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table thermostat:
-- Smart Controller Thermostat Interface State,
-- where always:
--		  0 = inactive
--		  1 = active
--
-- id		- unique record ID
-- updated	- last state update date and time
-- W1		- W1 wire state
-- W2		- W2 wire state
-- Y1		- Y1 wire state
-- Y2		- Y2 wire state
-- G		- G wire state
-- OB		- O/B wire state
-- Aux		- Aux wire state
-- Rc		- Rc wire state
-- Rh		- Rh wire state
-- Hum		- external humidistat state
-- avg_t	- average of all sensors in zone 0 (master) when a call is detected from the thermostat. This will require the smart controller to send an ASEMP request to read the sensors in Zone 0
--
CREATE TABLE `thermostat` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime NOT NULL,
  `W1` tinyint(4) DEFAULT NULL,
  `W2` tinyint(4) DEFAULT NULL,
  `Y1` tinyint(4) DEFAULT NULL,
  `Y2` tinyint(4) DEFAULT NULL,
  `G` tinyint(4) DEFAULT NULL,
  `OB` tinyint(4) DEFAULT NULL,
  `Aux` tinyint(4) DEFAULT NULL,
  `Rc` tinyint(4) DEFAULT NULL,
  `Rh` tinyint(4) DEFAULT NULL,
  `Hum` tinyint(4) DEFAULT NULL,
  `avg_t` decimal(6, 2) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table smartdevices:
-- Smart Controller local sensors and controls
--
-- id		- Unique record ID
-- updated	- Last state update date and time
-- type_	- Device type:
--		  0 = onboard CO2 sensor
--		  1 = onboard CO sensor
--		  2 = onboard Temperature sensor
--		  3 = onboard Humidity sensor
--		  4 = generic Temperature
--		  5 = generic Humidity
--		  6 = generic Velocity
--		  7 = generic Illumination
--		  8 = generic Pressure
--		  80 = flood sensor
--		  81 = hot water tank on/off control
--		  82 = damper control
-- interface	- Interface type:
--		  0 = ADC
--		  1 = I2C
--		  2 = 1-wire
--		  3 = IP
--		  4 = zigbee
--		  5 = relay
-- status	- Device status:
--		  0 = Disabled
--		  1 = Enabled
-- period	- Values read interval or period between readings:
--		  0 = turn OFF reading
--		  30 = minimal reading interval
--		  40 = default reading interval
--		  180 = maximum reading interval
-- lowthres	- ADC port low threshold RAW value. 0 means no threshold
-- highthres	- ADC port high threshold RAW value. 0 means no threshold
-- address	- IP name address for IP interface device;
--		  Zigbee Network adress for Zigbee addressed device;
--		  I2C Address for I2C interface device;
--		  1-wire Address for 1-wire device
-- relay	- ID of relay connected to device. value from 1 to 6. 0 = not used
-- speed	- I2C or 1-wire bus speed. applicable only when I2C or 1-wire bus selected
--		  0 or NULL = automatic speed detection, 100khz by default
--		  for CO sensors used as correction value storage		- bad practice! fix on next spin
-- alarm	- Alarm event enable:
--		  0 = no (default)
--		  1 = yes
-- severity	- Device event/alarm severity:
--		  0 = Green (lowest)
--		  1 = Yellow
--		  2 = Red (highest)
-- maker	- Manufacturer of the device
-- model	- Model of the device
-- description  - Optional device description entered by Administrator
--
CREATE TABLE `smartdevices` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `interface` int(11) DEFAULT NULL,
  `status` int(11) DEFAULT 0,
  `period` int(11) DEFAULT 40,
  `lowthres` int(11) DEFAULT 0,
  `highthres` int(11) DEFAULT 0,
  `address` varchar(50) DEFAULT NULL,
  `relay` int(11) DEFAULT NULL,
  `speed` int(11) DEFAULT NULL,
  `alarm` int(11) NOT NULL DEFAULT 0,
  `severity` int(11) DEFAULT NULL,
  `maker` varchar(200) DEFAULT NULL,
  `model` varchar(200) DEFAULT NULL,
  `description` varchar(200) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8 PACK_KEYS=0;

-- Description of table smartsensors:
-- Smart Controller onboard sensors values
--
-- id		- unique record ID
-- updated	- last state update date and time
-- type_	- report type:
--		  0 = periodic or requested by command
--		  1 = CO threshold level exceeded
--		  2 = CO2 threshold level exceeded
--		  3 = t_supply_duct upper threshold exceeded
--		  4 = t_supply_duct lower threshold exceeded
--		  5 = t_return_duct upper threshold exceeded
--		  6 = t_return_duct lower threshold exceeded
-- froom_t	- Furnace Room Temperature in Celsius degrees
-- froom_h	- Furnace Room Humidity in %
-- co		- Return Duct CO readings in ppm
-- co2		- Return Duct CO2 readings in ppm
-- t_int	- temperature inside Smart controller (MCU) case
-- t_supply_duct	- supply duct temperature
-- t_return_duct	- return duct temperature
-- h_supply_duct	- supply duct humidity
-- h_return_duct	- return duct humidity
-- htu		- 40 to 125 Deg C, 12 bit resolution, 2 decimal places, typical ± 0.04
-- air_vel	- Supply Duct Air Velocity fpm
--
CREATE TABLE `smartsensors` (
  id int(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  updated datetime NOT NULL,
  type_ int(11) DEFAULT NULL,
  froom_t decimal(6, 1) DEFAULT NULL,
  froom_h int(11) DEFAULT NULL,
  co int(11) DEFAULT NULL,
  co2 int(11) DEFAULT NULL,
  t_int decimal(6, 1) DEFAULT NULL,
  t_supply_duct decimal(6, 1) DEFAULT NULL,
  t_return_duct decimal(6, 1) DEFAULT NULL,
  h_supply_duct int(11) DEFAULT NULL,
  h_return_duct int(11) DEFAULT NULL,
  htu decimal(6, 2) DEFAULT NULL,
  air_vel int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=UTF8 PACK_KEYS=0;

-- Description of table relays:
-- Smart Controller Relays State
-- where always:
--		  0 = inactive
--		  1 = active
--		  2,3 = bypass (for HVAC relay groups only)
-- 
-- id		- unique record ID
-- updated	- last state update date and time
-- R1		- R1 relay state
-- R2		- R2 relay state
-- R3		- R3 relay state
-- R4		- R4 relay state
-- R5		- R5 relay state
-- R6		- R6 relay state
-- Humidifier	- humidifier relay state
-- W1		- HVAC W1 relays group state
-- W2		- HVAC W2 relays group state
-- Y1		- HVAC Y1 relays group state
-- Y2		- HVAC Y2 relays group state
-- G		- HVAC G relays group state
-- OB		- HVAC O/B relays group state
-- Aux		- HVAC AUX relays group state
-- RcRh		- HVAC Rc-Rh bridge relay state
--
CREATE TABLE `relays` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `updated` datetime NOT NULL,
  `R1` tinyint(4) DEFAULT NULL,
  `R2` tinyint(4) DEFAULT NULL,
  `R3` tinyint(4) DEFAULT NULL,
  `R4` tinyint(4) DEFAULT NULL,
  `R5` tinyint(4) DEFAULT NULL,
  `R6` tinyint(4) DEFAULT NULL,
  `Humidifier` tinyint(4) DEFAULT NULL,
  `W1` tinyint(4) DEFAULT NULL,
  `W2` tinyint(4) DEFAULT NULL,
  `Y1` tinyint(4) DEFAULT NULL,
  `Y2` tinyint(4) DEFAULT NULL,
  `G` tinyint(4) DEFAULT NULL,
  `OB` tinyint(4) DEFAULT NULL,
  `Aux` tinyint(4) DEFAULT NULL,
  `RcRh` tinyint(4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table zigbee:
-- Smart controller Zigbee network
--
-- id		- unique zigbee network participant ID
-- channel	- RF channel selected by the zigbee radio, based on the above bitmask: 
--			0x04000000 - channel 26 - 0x1A
--			0x02000000 - channel 25 - 0x19
--			0x01000000 - channel 24 - 0x18
--			0x00800000 - channel 23 - 0x17
--			0x00400000 - channel 22 - 0x16
--			0x00200000 - channel 21 - 0x15
--			0x00100000 - channel 20 - 0x14
--			0x00080000 - channel 19 - 0x13
--			0x00040000 - channel 18 - 0x12
--			0x00020000 - channel 17 - 0x11
--			0x00010000 - channel 16 - 0x10
--			0x00008000 - channel 15 - 0x0F
--			0x00004000 - channel 14 - 0x0E
--			0x00002000 - channel 13 - 0x0D
--			0x00001000 - channel 12 - 0x0C
--			0x00000800 - channel 11 - 0x0B
-- panid	- PAN ID selected by the zigbee radio or set by the admin
-- panid_sel	- PAN ID Selection:
--		  0 = Manual
--		  1 = Automatic PAN ID generation by the zigbee radio
-- addr64	- Coordinator Zigbee radio MAC address
-- addr16	- Smart Controller generated short address
-- encryption	- Encryption:
--		  0 = Disabled
--		  1 = Enabled
-- sec_key	- Key used to securely transmit data over zigbee
-- mfc_id	- Zigbee radio manufacturer ID
-- hw_version	- Zigbee radio hardware version
-- sw_version	- Zigbee radio firmware version
-- alarms	- Alarms enabled:
--		  0 = Disabled (default)
--		  1 = Enabled
--
CREATE TABLE `zigbee` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `channel` int(11) DEFAULT NULL,
  `chan_sel` tinyint(4) NOT NULL DEFAULT '1',
  `panid` int(11) DEFAULT NULL,
  `panid_sel` tinyint(4) NOT NULL DEFAULT '1',
  `addr64` varchar(32) NOT NULL,
  `addr16` varchar(16) NOT NULL,
  `encryption` tinyint(4) DEFAULT '1',
  `sec_key` varchar(100) DEFAULT NULL,
  `mfc_id` varchar(100) DEFAULT NULL,
  `hw_version` varchar(100) DEFAULT NULL,
  `sw_version` varchar(100) DEFAULT NULL,
  `alarms` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table networks:
-- Smart controller IP network
--
-- id		- unique IP network settings profile ID
-- dns1		- Default primary DNS. 8.8.8.8 Google. Can be updated via web UI
-- dns2		- Default secondary DNS. 8.8.4.4 Google. Can be updated via web UI
-- cloud1	- primary ASE Cloud server IP address
-- cloud2	- secondary ASE Cloud server IP address
-- ap_name	- Smart Controller Access Point Name. RetroSAVEXXX. XXX randomly generated by the smart controller software.
-- ap_channel	- Smart Controller Access Point Channel. 1-11 (14) depends on country regulations.
--		  0 = Automatic (default)
-- ap_security	- Smart Controller access point key. Default = `Magellan`. Can be updated via the web UI
-- ap_protocol	- Smart Controller security protocol:
--		  0 = WPA2 (default)
--		  1 = WPA
--		  2 = None
-- lan_dhcp	- Ethernet/LAN IP access:
--		  0 = Static
--		  1 = Dynamic (DHCP)
-- lan_ip	- LAN IP address
-- lan_gateway	- LAN default gateway
-- lan_netmask	- LAN netmask
-- lan_dns	- LAN DNS retrieved via DHCP or set locally
-- wan_ap_name	- Customer WiFi Access Point Name
-- wan_ap_key	- Customer Wifi access point key
-- timeserver1	- Main timeserver used to synchronize smart controller clock
-- timeserver2	- Secondary timeserver used to synchronize smart controller clock
-- cell_modem	- Cell modem (2G/3G/EDGE/GPRS) installed and connected:
--		  0 = No
--		  1 = Yes
-- cell_type	- Cell modem type (maker and model)
-- weather1	- Main weather website
-- weather2	- Secondary weather website
-- alarms	- Alarms enabled:
--		  0 = Disabled (default)
--		  1 = Enabled
--
CREATE TABLE `networks` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `dns1` varchar(20) NOT NULL,
  `dns2` varchar(20) DEFAULT NULL,
  `cloud1` varchar(20) NOT NULL,
  `cloud2` varchar(20) DEFAULT NULL,
  `ap_name` varchar(50) NOT NULL,
  `ap_channel` tinyint(4) NOT NULL DEFAULT '0',
  `ap_security` varchar(10) NOT NULL,
  `ap_protocol` int(11) DEFAULT '0',
  `lan_dhcp` tinyint(4) NOT NULL DEFAULT '1',
  `lan_ip` varchar(20) DEFAULT NULL,
  `lan_gateway` varchar(20) DEFAULT NULL,
  `lan_netmask` varchar(20) DEFAULT NULL,
  `lan_dns` varchar(20) DEFAULT NULL,
  `wan_ap_name` varchar(50) DEFAULT NULL,
  `wan_ap_key` varchar(50) DEFAULT NULL,
  `timeserver1` varchar(20) NOT NULL,
  `timeserver2` varchar(20) DEFAULT NULL,
  `cell_modem` tinyint(4) NOT NULL DEFAULT '0',
  `cell_type` varchar(100) DEFAULT NULL,
  `weather1` varchar(200) DEFAULT NULL,
  `weather2` varchar(200) DEFAULT NULL,
  `alarms` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table equipment:
-- List of supported HVAC equipment
--
-- id		- unique equipment local ID
-- type_	- equipment type:
--		  0 = Furnace
--		  1 = AC
--		  2 = Heat pump
--		  3 = HRV/ERV
--		  4 = COTS Thermostat
-- stages	- available stages:
--		  0 = 1 single stage
--		  1 = Dual stage
--		  2 = Modulating
-- maker	- Maker/manufacturer
-- model	- Model of equipment
-- max_on	- Maximum equipment ON time
-- min_on	- Minimum equipment ON time
-- min_off	- Minimum equipment OFF time
-- out_temp_cut	- Outside temperature cutoff
-- cots_type	- Commercial Out of The Shelf thermostat type:
--		  0 = Analog
--		  1 = Smart
--
CREATE TABLE `equipment` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `type_` int(11) unsigned NOT NULL,
  `stages` int(11) unsigned NOT NULL,
  `maker` varchar(100) NOT NULL,
  `model` varchar(200) NOT NULL,
  `max_on` int(11) NOT NULL DEFAULT '0',
  `min_on` int(11) NOT NULL DEFAULT '0',
  `min_off` int(11) NOT NULL DEFAULT '0',
  `out_temp_cut` int(11) DEFAULT NULL,
  `cots_type` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table asemp:
-- ASE Messaging protocol profiles, structured
-- 
-- id		- unique profile record ID
-- profile_id	- ASEMP Profile ID
-- parameter	- ASEMP parameter name/nick/short description
-- value	- current value
-- default	- default/factory value
-- description	- full menu item description or profile name
-- type_	- parameter type:
--		  0 - boolean (yes/no)
--		  1 - digit entry
--		  2 - profile name
-- units	- measurement units short description
--
CREATE TABLE `asemp` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `profile_id` int(11) NOT NULL DEFAULT '0',
  `parameter` varchar(50) NOT NULL,
  `value` int(11) DEFAULT NULL,
  `default` int(11) NOT NULL DEFAULT '0',
  `description` varchar(200) DEFAULT NULL,
  `type_` tinyint(4) NOT NULL DEFAULT '0',
  `units` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table temperatureprofile:
-- table to set defaults for temperature profiles
--
-- id           - temperature profile unique identifier
-- description  - temperature profile description
-- temperature  - target default temperature value in Celsium degrees, used when no value presents in TemperatureBreakout table
--                  zero T value means profile/zone is hidden/virtual, used for sensor records only, like Outdoor T&H sensors
-- humidity     - target humitidy, from zero to 100 with 10 breakout
--
CREATE TABLE temperatureprofile (
    id          INT             AUTO_INCREMENT NOT NULL,
    description VARCHAR(255)    DEFAULT NULL,
    temperature REAL            NOT NULL,
    humidity    REAL            NOT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table temperaturebreakout:
-- 
-- id                       - unique record id
-- temperature_profile_id   - temperature profile ID, from temperatureprofile
-- dayofweek                - day of week where 0 - sunday, 1 - monday .. 6 - caturday
-- timeframe                - timeframe for target temperature, set as HHMM. range is 0000 - 2359. example 0130 - is 1.30am
-- temperature              - target temperature in Celsium degrees
--
CREATE TABLE temperaturebreakout (
    id                      INT             AUTO_INCREMENT NOT NULL,
    temperature_profile_id  INT             NOT NULL,
    dayofweek               INT             NOT NULL,
    timeframe               INT             NOT NULL,
    temperature             REAL            NOT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table zones:
--   Zones defined in conrtoller.
-- Fields:
-- id			- unique zone identifier. reserved values:
--			  1 - temporary / virtual zone where new devices being added
--			  2 - master zone that contains master sensor
-- temperature_profile_id	- temperature profile for zone:
--			  0 = special zone assignment (virtual or outdoor)
--			  1 = default profile
-- description		- text description of zone
-- volume		- zone volume in cubic meters (currently unused). zone with bigger volume is MAIN ZONE (see ASE definitions)
-- sleep_area		- Zone Designation as sleep area:
--			  0 = No (default)
--			  1 = Yes
-- level		- Zone level. Options are: 
--			  0 = Same as Master Sensor (default)
--			  1 = Above Master Sensor
--			  2 = Below Master Sensor
-- orientation		- Zone orientation. Options are: 
--			  0 = N/A (default)
--			  1 = Facing South
--			  2 = Facing North
--			  3 = Facing West
--			  4 = Facing East
--
CREATE TABLE `zones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `temperature_profile_id` int(11) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `volume` double DEFAULT NULL,
  `sleep_area` int(11) NOT NULL DEFAULT 0,
  `level` int(11) DEFAULT 0,
  `orientation` int(11) DEFAULT 0,
  PRIMARY KEY (id),
  INDEX temperature_profile_id (temperature_profile_id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table zonesdyn:
--   Zones dynamic parameters
-- Fields:
--   zone_id                - unique zone dynamic parameter identifier
--   occupation             - occupation flag
--                              0 - zone not occupied ;
--                              1 - zone occupied ;
--                              2 - zone semi-occupied ;
--   state                  - current zone state :
--                              0 - none
--                              1 - ventilation
--                              2 - reheating
--                              3 - heat call
--                              4 - preheating (pending)
--   timer_on               - timer in cycles (heartbeats) to start event
--   timer_off              - timer in cycles (heartbeats) to stop event
--   priority               - event priority, lower number is lower priority, 1 - highest priority
--
CREATE TABLE `zonesdyn` (
  `zone_id` int(11) NOT NULL,
  `occupation` int(11) DEFAULT '0',
  `state` int(11) DEFAULT '0',
  `timer_on` int(11) DEFAULT '0',
  `timer_off` int(11) DEFAULT '0',
  `priority` int(11) DEFAULT '0',
  PRIMARY KEY (`zone_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table devices:
--   Common information for all XBee devices.
-- Fields:
--   id            - XBee device unique identifier
--   zone_id       - zone where XBee device currently located
--   hardware_type - 0 by default. for device type = 0 and ASE device type 0x80 (step motor) : 
--		     1 = supply air flap
--		     2 = return air flap
--   device_type   - device type :
--		     0 = ASEMP device
--		     80 = 3rd party Zigbee device
--   description   - XBee device description
--   xbee_addr64   - XBee network address
--   asemp	   - OBSOLETE! 
--   serial	   - ASE remote device unique serial number
--
CREATE TABLE `devices` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `zone_id` int(11) NOT NULL DEFAULT '1',
  `hardware_type` int(11) NOT NULL DEFAULT '0',
  `device_type` int(11) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `xbee_addr64` varchar(31) DEFAULT NULL,
  `asemp` int(11) NOT NULL DEFAULT '1',
  `serial` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `zone_id` (`zone_id`)
) ENGINE=MyISAM AUTO_INCREMENT=24 DEFAULT CHARSET=utf8;

-- Description of table devicesdyn:				OBSOLETE!!!!!!!!
-- Devices common dynamic parameters
-- Missing of corresponding devicesdyn line for device means device is deleted or unused
--
-- Fields:
--   device_id     - unique device dynamic parameter identifier
--   online        - is device currently online/enabled :
--		     0 = device offline / disabled
--		     1 = device online / enabled
--   device_status - additional status property, RSSI level when applicable :
--                   -1 - connection lost
--                   positive value - reception level in dBm, 60 means -60dBm
--   updated_time  - date and time of last status update
--   battery_charge - battery charge in percent (0-100). > 101 - AC powered
--   remote_ack	   - 0 = FALSE. 1 = TRUE (remote acknowledged smart controller ASEMP request). Default Set to 1.		OBSOLETE!!!!!!!! moved to remotecontrol
--
CREATE TABLE `devicesdyn` (
  `device_id` int(11) NOT NULL,
  `online` tinyint(1) DEFAULT NULL,
  `device_status` int(11) DEFAULT NULL,
  `updated_time` datetime DEFAULT NULL,
  `battery_charge` int(11) DEFAULT NULL,
  `remote_ack` tinyint(4) DEFAULT '1',
  PRIMARY KEY (`device_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table paramsensordyn:
--   Additional parameters for temperature, humidity, light, motion for all types of sensors
--   Concrete sensor type described in Devices.hardware_type
-- Fields:
--   device_id      - XBee device identifier from Devices table
--   light          - light in Lumens (LTH sensor)
--   temperature    - temperature in Celsium degrees
--   humidity       - environment humidity in percent (0-100)
--   motion         - motion presense (0 - no, 1 - yes)
--
CREATE TABLE `paramsensordyn` (
  `device_id` int(11) NOT NULL,
  `light` double DEFAULT NULL,
  `temperature` double DEFAULT NULL,
  `humidity` double DEFAULT NULL,
  `motion` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`device_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table paramgassensordyn:							OBSOLETE!!!!!!!!! must be removed
--   Additional parameters for pir,CO2,CO levels for all types of sensors
--   Concrete sensor type described in Devices.hardware_type
-- Fields:
--   device_id      - XBee device identifier from Devices table
--   pir            - Number of PIR events registered
--   co2_ppm        - CO2 level (Gas/PIR sensor)
--   co_ppm         - CO level (Gas/PIR sensor)
--   temperature1   - -40 to 125 Deg C, 12 bit resolution, 2 decimal places, typical ± 0.04
--   temperature2   - -40 to 125 Deg C, 12 bit resolution, 2 decimal places, typical ± 0.04
--
CREATE TABLE `paramgassensordyn` (
  `device_id` int(11) NOT NULL,
  `pir` int(11) DEFAULT NULL,
  `co2_ppm` int(11) DEFAULT NULL,
  `co_ppm` int(11) DEFAULT NULL,
  `temperature1` float(9,3) DEFAULT NULL,
  `temperature2` float(9,3) DEFAULT NULL,
  PRIMARY KEY (`device_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table paramflapdyn					OBSOLETE!!!!!!!!! must be removed
--   Additional parameters for all types of airflow diffusers
--   A concrete diffuser type described in Devices.hardware_type
--   A diffuser subtype described in Devices.device_type
-- Fields:
--   device_id      - XBee device identifier from Devices table
--   position	    - louver position (0-90), when <50% - closed / >50% - opened for 2-stage louver
--		      0-90 deg. 0=CLOSED, 90=FULLY OPEN. Increments 5 deg - for Smart Diffuser
--   temperature    - temperature in Celsium degrees (if applicable)
--   airflow        - airflow level, where 0 - no flow (if applicable)
--   dimmer	    - dimmer value (if applicable)
CREATE TABLE `paramflapdyn` (
  `device_id` int(11) NOT NULL,
  `position` int(11) DEFAULT NULL,
  `temperature` double(15,3) DEFAULT NULL,
  `airflow` double(15,3) DEFAULT NULL,
  `dimmer` int(11) DEFAULT NULL,
  PRIMARY KEY (`device_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table deviceadvanced							OBSOLETE!!!!!!!!!!! must be removed
--   Advanced parameters for sensors and diffusers
--   like close/open angles or sensor values correction
-- Fields:
--   id             - unique record identifier
--   device_id      - unique device identifier from Devices table
--   type_          - parameter type :
--                    0 - undefined
--                    1 - temperature or CO level or Sound level (depends on sensor type)
--                    2 - light/illumination or CO2 level (depends on sensor type)
--                    3 - humidity or PIR level (depends on sensor type)
--                    4 - angle for diffuser (currently unused)
--                    5 - advanced device type (OBSOLETE!)
--   realvar1       - first variable
--                    for sensor is multiplicative modifier, by default is 1
--                    for diffuser is angle to make flaps fully closed, by default is 0
--                    for advanced device type :
--                    0 - L/T/H sensor
--                    1 - CO/CO2/PIR sensor
--                    2 - Sound level sensor
--   realvar2       - second variable
--                    for sensors is additive modifier, by default is 0
--                    for diffuser is angle to make flaps fully opened, by default is 90
--
CREATE TABLE deviceadvanced (
    id                        INT             AUTO_INCREMENT NOT NULL,
    device_id                 INT             NOT NULL,
    type_                     INT             NOT NULL,
    realvar1                  REAL            NOT NULL,
    realvar2                  REAL            NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (device_id) REFERENCES devices (id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table zoneadvanced
--   Advanced parameters for zones
--   like deltaT correction, recovery factor, off timers, etc
-- Fields:
--   id             - unique record identifier
--   zone_id        - unique zone identifier from Zones table
--   type_           - parameter type :
--                    0 - undefined
--                    1 - deltaT correction (if applicable)
--   realvar1       - first variable
--                    for deltaT correction, recovery factor. default is 0.3
--   realvar2       - second (optional) variable
--                    for deltaT correction, off timer. default is 60 min
--   realvar3       - third (optional) variable
--
CREATE TABLE zoneadvanced (
    id          INT         AUTO_INCREMENT NOT NULL,
    zone_id     int(11)     NOT NULL,
    type_       int(11)     NOT NULL,
    realvar1    float(9,3)  DEFAULT NULL,
    realvar2    float(9,3)  DEFAULT NULL,
    realvar3    float(9,3)  DEFAULT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (zone_id) REFERENCES zones (id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table hvac:
-- Parameters to control HVAC functions
-- as described in 'HVAC UI Menu' document
-- referenced by version 1.5.2
--
-- Fields:
-- id           - unique ID. used for submenu reference
-- option_      - unique text identificator. used for input fields and submenu dependencies
-- description  - menu item description, used to display menu only
-- submenu      - sub-menu reference :
--                0 - main menu items, 
--                >0 - sub-menu items, 
--                -1 - hidden items (version, settings)
-- value_       - current option value, could be NULL for main menu items
--                default value placed here on database init
-- type_        - input type. could be NULL for non-input items (main menu, descriptions) :
--                1 - text input fields
--                2 - readonly text input fields
--                3 - drop-down selection
--                4 - comment for submenu
--		  5 - special types, defined in code
--		  6 - subsection
-- selections   - values to choose from, value borders :
--                empty or NULL for simple text input - any value of allowed length will be passed ;
--                XX,YY - for numeric input, where XX is minimum allowed value, YY is maximum allowed value ;
--                XX::YY;;XX1::YY1;;XXn::YYn - for radio or drop-down selection, where XX is value placed to 'value_' field, YY is description visible to user ;
--                %%MACRO - for drop-down selections, where MACRO is macro-command to create list of selections. available commands :
--                %%SENSORS - get list of sensors with IDs
--                %%PTLIST - get list of temperature probes with IDs
--                %%RELAYS - get list of relays with IDs
--		  %%NEST - includes subsection contents for Nest thermostat
--		  XX - for text value, field size
-- dependence   - used when submenu items visibility depends on other items input (enabled or disabled) :
--                empty or NULL for sub-menu item always displayed ;
--                XX::YY - for dependent input where XX is submenu identificator taken from 'option_' field, YY is required parent sub-menu value.
-- permissions  - used to allow or deny access to selected menu items for users with different permissions
--		  0 - allow to use for everyone
--		  1 - allow to smart controller administrator only
--		  2 - allow to superuser / cloud administrator
--		  3 - invisible
-- units	- short text description of measurement units, if applicable
--

CREATE TABLE `hvac` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `option_` varchar(50) NOT NULL,
  `description` varchar(200) NOT NULL,
  `submenu` int(11) NOT NULL DEFAULT '0',
  `value_` varchar(100) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `selections` varchar(200) DEFAULT NULL,
  `dependence` varchar(200) DEFAULT NULL,
  `permissions` int(11) unsigned NOT NULL DEFAULT '0',
  `units` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`),
  UNIQUE KEY `option_` (`option_`),
  UNIQUE KEY `option__2` (`option_`)
) ENGINE=MyISAM AUTO_INCREMENT=101 DEFAULT CHARSET=latin1;

-- Description of table cloud:
-- Parameters to control Cloud server functions
--
-- Fields:
-- id           - unique ID. used for submenu reference
-- option_      - unique text identificator. used for input fields and submenu dependencies
-- description  - menu item description, used to display menu only
-- submenu      - sub-menu reference :
--                0 - main menu items, 
--                >0 - sub-menu items, 
--                -1 - hidden items (version, settings)
-- value_       - current option value, could be NULL for main menu items
--                default value placed here on database init
-- type_        - input type. could be NULL for non-input items (main menu, descriptions) :
--                1 - text input fields, 
--                2 - radio button input,
--                3 - drop-down selection
--                4 - comment for submenu
--		  5 - special types, defined in code
-- selections   - values to choose from, value borders :
--                empty or NULL for simple text input - any value of allowed length will be passed ;
--                XX,YY - for numeric input, where XX is minimum allowed value, YY is maximum allowed value ;
--                XX::YY;;XX1::YY1;;XXn::YYn - for radio or drop-down selection, where XX is value placed to 'value_' field, YY is description visible to user ;
--		  XX - for text value, field size
-- dependence   - used when submenu items visibility depends on other items input (enabled or disabled) :
--                empty or NULL for sub-menu item always displayed ;
--                XX::YY - for dependent input where XX is submenu identificator taken from 'option_' field, YY is required parent sub-menu value.
-- permissions  - used to allow or deny access to selected menu items for users with different permissions
--		  0 - allow to use for everyone
--		  1 - allow to smart controller administrator only
--		  2 - allow to superuser / cloud administrator
--		  3 - invisible
-- units	- short text description of measurement units, if applicable
--
CREATE TABLE `cloud` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `option_` varchar(50) NOT NULL,
  `description` varchar(200) NOT NULL,
  `submenu` int(11) NOT NULL DEFAULT '0',
  `value_` varchar(100) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `selections` varchar(200) DEFAULT NULL,
  `dependence` varchar(200) DEFAULT NULL,
  `permissions` int(11) unsigned NOT NULL DEFAULT '0',
  `units` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`),
  UNIQUE KEY `option_` (`option_`),
  UNIQUE KEY `option__2` (`option_`)
) ENGINE=MyISAM AUTO_INCREMENT=101 DEFAULT CHARSET=latin1;

-- Description of table events:
-- Upcoming events and alarms shown via WebUI, mobile apps
--
-- Fields
-- id           - unique ID. used for event reference
-- started      - date and time when event/alarm was raised
-- ended        - date and time wnen event/alarm was cleared (if applicable)
-- severity     - event severity :
--                0 - information, not logged ;
--                1 - notification ;
--                2 - alarm, low priority event ;
--                3 - emergency, high priority alarm, warning
-- status       - event/alarm resolution status :
--                0 - active ;
--                1 - in progress ;
--                2 - cleared ;
--                3 - suspended
-- description  - event/alarm description
--
CREATE TABLE events (
  id int(11) unsigned NOT NULL AUTO_INCREMENT,
  started datetime NOT NULL,
  ended datetime DEFAULT NULL,
  severity tinyint(4) NOT NULL DEFAULT '0',
  status tinyint(4) NOT NULL DEFAULT '0',
  description varchar(200) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY id (id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table systems:
-- ASE Cloud list of connected systems
--
-- id           - unique system record ID
-- house_id     - house_id same to corresponding system constants field in HVAC table
-- version      - system version received from smart controller
-- connected    - date and time when connected last time
-- ip_address   - IP address last connected/synchronized from
-- description  - optional retrosave controller description
--
CREATE TABLE cloud2014.systems (
  id int(10) NOT NULL AUTO_INCREMENT,
  house_id int(11) UNSIGNED NOT NULL,
  version varchar(20) DEFAULT NULL,
  connected datetime DEFAULT NULL,
  ip_address varchar(32) DEFAULT NULL,
  description varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE INDEX house_id (house_id)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table users:
-- ASE Cloud and Smart Controller users and administrators
--
-- id           - unique ID, used for user reference
-- access       - access level :
--                0 - basic access level, view only. customer
--                1 - advanced access level, view/edit. administrator, system integrator
--                2 - super administrator / root level.             /ASE Cloud only/
-- dbid         - unique identifier of ASE Smart Controller
--                could be zero for superadmin                      /ASE Cloud only/
--                referred to Systems.id
-- ipaddress    - IP address last connected/synced from.            /ASE Cloud only/
-- connected    - date and time of latest user logon                /ASE Cloud only/
-- description  - brief user description if applicable. 
-- fullname     - user full name if applicable
--
CREATE TABLE users (
  id int(11) unsigned NOT NULL AUTO_INCREMENT,
  login varchar(100) NOT NULL,
  password varchar(100) NOT NULL,
  access int(11) NOT NULL DEFAULT '0',
  dbid int(11) NOT NULL DEFAULT '0',
  ipaddress varchar(25) DEFAULT NULL,
  connected datetime DEFAULT NULL,
  description varchar(255) DEFAULT NULL,
  fullname varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY id (id),
  UNIQUE KEY login (login,dbid)
) ENGINE=InnoDB CHARACTER SET=UTF8;

-- Description of table statistics:
-- ASE Processes internal events log including all device state changes
--
-- id           - unique ID, used for event reference
-- data         - date and time of event, by smart controller RTC
-- sim_id       - simulation ID if applicable. 0 for real system
-- zone_id      - ID of zone where event occured
-- device_id    - ID of device caused event (if applicable)
-- type         - type of event :
--                0 - return flap. T = flap state, L = zone state (described in ZonesDyn table)
--                1 - forward flap. T = flap state, L = zone state (described in ZonesDyn table)
--                2 - T/H/L sensor. T = temperature, H = humidity, L = luminance
--                3 - Gas/PIR sensor. T = CO2, H = CO, L = PIR status
--                4 - sound sensor. L = sound level (obsolete)
--                5 - flaps sensors. T = temperature, H = air flow
--                10 - THL target change. T = temperature, H = humidity, L = luminance
--                11 - occupation change. T = occupation, H = zone state, L = next event off-timer
--                12 - main zone event. T = heater state, H = fan state, L = A/C state
--                13 - additional data. T = battery status, H = Zigbee RSSI level, L = reporting interval
--		  14 - slider control. T = setting. 1 to 5. 1 = Max comfort, 5 = Max Savings. H = change source. 0 = local, 1 = remote
--                -1 - special event, tick timer, delimiter
-- T            - temperature (if applicable) or device/system/zone state from upper
-- H            - humidity (if applicable) or device/system/zone state from upper
-- L            - luminance (if applicable) or device/system/zone state from upper
-- report_type	- 0 = Unsolicited Periodic
--		  1 = Unsolicited PIR Triggered
--		  2 = Unsolicited Battery status triggered
--		  3 = Unsolicited temperature threshold triggered
--		  4 = Unsolicited humidity threshold triggered
--		  5 = Unsolicited Light Level Triggered
--		  6 = Smart Controller Solicited
--		  7 = GAS Sensors Periodic
-- 		  8 = GAS Sensors CO threshold level exceeded
--		  9 = GAS Sensors CO2 threshold level exceeded
--		 10 = GAS Sensors T1 upper threshold exceeded
--		 11 = GAS Sensors T1 lower threshold exceeded
--		 12 = GAS Sensors T2 upper threshold exceeded
--		 13 = GAS Sensors T2 lower threshold exceeded
--
CREATE TABLE `statistics` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `data` datetime NOT NULL,
  `sim_id` int(11) NOT NULL DEFAULT '0',
  `zone_id` int(11) NOT NULL,
  `device_id` int(11) NOT NULL,
  `type` int(11) NOT NULL,
  `report_type` tinyint(4) DEFAULT '0',
  `T` float(9,3) NOT NULL DEFAULT '0.000',
  `H` float(9,3) NOT NULL DEFAULT '0.000',
  `L` float(9,3) NOT NULL DEFAULT '0.000',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`),
  KEY `sim_id` (`sim_id`),
  KEY `data` (`data`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table states:								!!!OBSOLETE!!! table must be not used
-- ASE Processes zone status with ON/OFF timeouts
--
-- id           - uniqie ID, used for state reference
-- zone_id      - zone ID
-- state        - current zone state :
--                0 - zone not occupied ;
--                1 - zone occupied ;
--                2 - zone semi-occupied ;
-- timer_on     - delay in CYCLES before zone comes into required state
-- timer_off    - delay in CYCLES before zone comes off from required state (next state or unoccupied)
-- priority     - state priority, where 1 - lowest priority
--
CREATE TABLE states (
    `id`        int(11) unsigned NOT NULL AUTO_INCREMENT,
    `zone_id`   int(11) NOT NULL,
    `state`     int(11) NOT NULL,
    `timer_on`  int(11) NOT NULL,
    `timer_off` int(11) NOT NULL DEFAULT '0',
    `priority`  int(11) NOT NULL,
    PRIMARY KEY (`id`),
    UNIQUE KEY `id` (`id`),
    UNIQUE KEY `zone_id` (`zone_id`)
) ENGINE=MEMORY CHARACTER SET=UTF8;

-- Description of table notifications:
-- Alarms and Notifications sent to email and sms
--
-- id		- unique ID for reference
-- email	- email address to send notification to
-- phone	- phone number to send sms to
-- severity	- event severity to send event, bitmask :
--		  bit 0 - events (Green)
--		  bit 1 - alarms (Yellow)
--		  bit 2 - emergency (Red)
--
CREATE TABLE notifications (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `email` varchar(100) DEFAULT NULL,
  `phone` varchar(50) DEFAULT NULL,
  `severity` smallint(6) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table ui_menu:
-- Structure of UI menu and submenu with access levels
--
-- id		- unique ID for reference
-- menu		- character short menu ID
-- submenu	- character short submenu ID for level 1
--		  default choice for level 2
-- description	- long menu or submenu description
-- access	- minimal access level required for this menu or submenu
-- level	- menu level. 0 - main, 1 - submenu
--
CREATE TABLE `ui_menu` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `menu` varchar(30) DEFAULT NULL,
  `submenu` varchar(20) NOT NULL,
  `description` varchar(200) NOT NULL,
  `access` tinyint(4) NOT NULL DEFAULT '0',
  `level` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table history_store:
-- Store for all inserted, deleted and updated database records
--
-- timemark	- record timestamp
-- table_name	- name of modified table
-- pk_date_src	- source table unique ID
-- pk_date_dest	- destination table unique ID
-- record_state - database operation:
--		  1 = INSERT
--		  2 = UPDATE
--		  3 = DELETE
--
CREATE TABLE `history_store` (
  `timemark` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `table_name` tinytext NOT NULL,
  `pk_date_src` text NOT NULL,
  `pk_date_dest` text NOT NULL,
  `record_state` int(11) NOT NULL,
  PRIMARY KEY (`table_name`(100),`pk_date_dest`(100))
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- Description of table history_store_old:
-- Store synced DB objects. structure same to history_old
--
CREATE TABLE `history_store_old` (
  timemark timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  table_name tinytext DEFAULT NULL,
  pk_date_src text NOT NULL,
  pk_date_dest text DEFAULT NULL,
  record_state int(11) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- Description of table hvac_actions:
-- Temporary store for reference to last inserted records or commands of HVAC processing daemon
--
-- id		- unique ID for reference
-- ref_table	- reference table name (if applicable)
-- ref_id	- reference table ID. unique ID of last inserted record (if applicable)
-- type_	- record type:
--		  0 = Generic table updated notification
--		  1 = LAN settings changed
-- priority	- record priority, if applicable:
--		  0 = lowest priority
--
CREATE TABLE `hvac_actions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ref_table` varchar(200) DEFAULT NULL,
  `ref_id` int(11) DEFAULT NULL,
  `type_` int(11) NOT NULL DEFAULT 0,
  `priority` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (id)
) ENGINE = MEMORY DEFAULT CHARSET=utf8;

-- Description of table actions:
-- Temporary store for reference to last inserted records at the hardware status tables
--
-- id		- unique ID for reference
-- ref_table	- reference table name
-- ref_id	- reference table ID. unique ID of last inserted record
-- type_	- record type:
--		  0 = smart controller onboard hardware (relays, etc)
--		  1 = remote controller hardware (louvers, switches, etc)
-- priority	- record priority, if applicable:
--		  0 = lowest priority
--
CREATE TABLE `actions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ref_table` varchar(200) DEFAULT NULL,
  `ref_id` int(11) DEFAULT NULL,
  `type_` int(11) NOT NULL DEFAULT 0,
  `priority` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (id)
) ENGINE = MEMORY DEFAULT CHARSET=utf8;

-- Description of table commands:
-- Store for service app commands flow
--
-- id		- unique ID for reference
-- updated	- date and time of last value update
-- command	- command ID defined in list of commands:
--		  0  = smart controller board restart
--		  1  = smart controller board internal diagnostics
--		  16 = set HVAC relays
--		  17 = set auxilary relays
--		  18 = set humidifier relay
--		  19 = set relay
--		  20 = reset relay
--		  33 = Gas sensors reading (CO sensor)
--		  34 = Thermostat line status reading
--		  35 = ADC connected probes reading
--		  36 = I2C connected sensors reading
--		  37 = 1-wire probes reading
--		  38 = 1-wire enumerate
--		  48 = Reset radio module
--		  49 = Create Zigbee network
--		  50 = Set PAN ID for existing network
--		  51 = Set RF channel
--		  52 = Set data encryption mode and security key
--		  53 = Allow/disallow new devices to join
--		  54 = Unregister previously registered Zigbee device
--		  55 = Route discovery
--		  56 = Ping remote device
--		  57 = ZED Enable / Disable
--		  65 = AC ON/OFF
--		  66 = AC current reading
--		  80 = Registration Response
--		  81 = Unsolicited Sensor Message INFO Response
--		  82 = Central Command Request
--		  86 = Update Profile Request
--		 115 = Enable local sensor
--		 116 = Disable local sensor
--		 117 = Read current value from sensor
--		 118 = Set update interval for sensor
--		 119 = Set high threshold for local sensor
--		 120 = Set low threshold for local sensor
--		 126 = Set RTC
--		 127 = Get RTC
-- priority	- record priority, if applicable:
--		  0 = lowest priority
-- flags	- bitmapped flags:
--		  bit 0 - disable lower level process from executing further commands
-- device_id	- referenced ID from the `devices` table if applicable
-- type_	- type of command from the list below, if applicable:
--		  0 = Louver position change. additional parameter passed (0 - 90 deg): 
--			0 = Closed, 
--			90 = Fully open, 
--			255 = Clears jam flag. 
--		  1 = AC Device Enable
--		  2 = AC Device Disable
--		  3 = Dimmer control. additional parameter passed (0 - 100): 
--			0 = fully OFF, 
--			100 = fully ON.
--		  4 = Modify Report interval. passed via parameters. seconds
--		  5 = Request the sensor to transmit an Unsolicited Sensor Message INFO Packet back to smart controller
--		  6 = Enable Alarm LED
--		  7 = Disable Alarm LED
--		  8 = Enable Audible alarm
--		  9 = Disable Audible alarm
--		 10 = Set relay, ID passed via parameters
--		 11 = Reset relay, ID passed via parameters
--		 12 = IR Tx command, IR reference ID passed via parameters
-- parameters	- optional field (alowed to NULL) that passing parameters to the command procedure
--
CREATE TABLE `commands` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime NOT NULL,
  `command` int(11) NOT NULL DEFAULT 0,
  `priority` int(11) NOT NULL DEFAULT 0,
  `flags` int(11) NOT NULL DEFAULT 0,
  `device_id` int(11) DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `parameters` varchar(255) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table smartsensorsraw:
-- Store for raw values of sensors and probes connected to smart board ports
--
-- id		- unique ID for reference
-- updated	- date and time of last value update
-- source	- value source:
--		  0 = ADC
--		  1 = I2C device
--		  2 = 1-wire device
-- type_	- raw value type:
--		  0 = unknown type
--		  1 = temperature
--		  2 = humidity
--		  3 = CO level
--		  4 = CO2 level
--		  5 = air velocity
--		  6 = light / illumination
-- address	- source address:
--		  for 1-wire = 64-bit device address
--		  for i2c bus = 7-bit, 8-bit or 10-bit device address
--		  for ADC = corresponds to onboard ADC number, like 1, 2, 3 ,4 corresponding to CS names
-- value_	- raw value or NULL
--
CREATE TABLE `smartsensorsraw` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `source` int(11) NOT NULL DEFAULT 0,
  `type_` int(11) NOT NULL DEFAULT 0,
  `address` varchar(64) DEFAULT NULL,
  `value_` varchar(64) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table diagnostics:
-- Smart board self-diagnostics results
--
-- id		- unique ID for reference
-- updated	- date and time of log entry
-- type_	- diagnostics event type:
--		  0 = test passed
--		  1 = test failed
-- event	- diagnostics event description
--
CREATE TABLE `diagnostics` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT 0,
  `event` varchar(500) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table smartplugsdyn
-- Parameters and values for Digi Smart plugs
--
-- device_id	- unique device identifier reference to Devices table
-- state	- electrical outlet state:
--		  0 = OFF
--		  1 = ON
-- current	- electrical device current consumption (raw value as received from Digi device)
--
CREATE TABLE `smartplugsdyn` (
  `device_id` int(11) NOT NULL,
  `state` int(11) DEFAULT NULL,
  `current` int(11) DEFAULT NULL,
  UNIQUE INDEX device_id (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table irdata:
-- Infrared remote sequences storage
--
-- id		- unique ID for reference
-- device	- device name or NULL if not applicable
-- command	- command name or NULL if not applicable
-- parameters	- command parameters (modulating frequence, header, prefix, leading, checksum, etc)
-- sequence	- binary remote sequence in HEX format
--
CREATE TABLE `irdata` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `device` varchar(255) DEFAULT NULL,
  `command` varchar(255) DEFAULT NULL,
  `parameters` varchar(255) DEFAULT NULL,
  `sequence` varchar(1000) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

-- Description of table remotecontrol:
-- Store for smart controller initiated control requests
--
-- id		- unique ID for reference
-- updated	- date and time of last value update
-- type_	- event / report type:
-- 		  0 = Unsolicited Periodic
--		  1 = Unsolicited PIR Triggered
--		  2 = Unsolicited Battery status triggered
--		  3 = Unsolicited temperature threshold triggered
--		  4 = Unsolicited humidity threshold triggered
--		  5 = Unsolicited Light Level Triggered
--		  6 = Smart Controller Solicited
-- device_id	- Remote device identifier from Devices table
-- louver_pos	- Louver Position, 0 - 90 deg. Increments 5 degrees
--		  0 = closed ;
--		  90 = fully open ; 
--		  255 = clear jam flag. 
-- ac_enable	- AC device powered ON : 
--		  1 = TRUE, 
--		  0 = FALSE
-- time_enable	- Amount of time in seconds the AC Device controlled by the ASE device is turned ON
-- dimmer	- AC dimmer value. 0 - 100 :
--		  0 = OFF, 
--		  100 = fully ON.
-- remote_ack	- Remote acknowledged smart controller ASEMP request
--		  0 = FALSE, 
--		  1 = TRUE (default).
-- rep_interval - Temporary reporting frequency interval :
--		  0 or NULL = Disable Temporary change in reporting frequency interval
--		  any positive value = Enable Temporary change in reporting frequency interval and set interval in seconds
-- irdata_id	- infrared remote sequence ID reference to `irdata` table that stores all sequences
-- alarm_aud	- Enable/Disable Audible Alarm :
--		  0 = Disabled,
--		  1 = Enabled
-- alarm_led	- Enable/Disable LED Alarm :
--		  0 = Disabled,
--		  1 = Enabled
-- relay_id	- relay ID reference to table that stores remote relays data - TBD
-- relay_set	- new relay status for the above relay:
--		  0 = Relay OFF
--		  1 = Relay ON
--
CREATE TABLE `remotecontrol` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) NOT NULL DEFAULT 0,
  `device_id` int(11) NOT NULL,
  `louver_pos` int(11) DEFAULT NULL,
  `ac_enable` int(11) DEFAULT NULL,
  `time_enable` int(11) DEFAULT NULL,
  `dimmer` int(11) DEFAULT NULL,
  `remote_ack` int(11) NOT NULL DEFAULT 1,
  `rep_interval` int(11) DEFAULT NULL,
  `irdata_id` int(11) DEFAULT NULL,
  `alarm_aud` int(11) DEFAULT NULL,
  `alarm_led` int(11) DEFAULT NULL,
  `relay_id` int(11) DEFAULT NULL,
  `relay_set` int(11) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table sensorsdyn:
-- Store for smart controller remote sensors data
--
-- id		- unique ID for reference
-- updated	- date and time of last value update
-- type_	- event / report type:
-- 		  0 = Unsolicited Periodic
--		  1 = Unsolicited PIR Triggered
--		  2 = Unsolicited Battery status triggered
--		  3 = Unsolicited temperature threshold triggered
--		  4 = Unsolicited humidity threshold triggered
--		  5 = Unsolicited Light Level Triggered
--		  6 = Smart Controller Solicited
-- device_id	- Remote device identifier from Devices table
-- temp_max	- Maximum temperature. -40 to 125 Deg C, 12 bit resolution, 2 decimal places
-- temp_min	- Minimum temperature. -40 to 125 Deg C, 12 bit resolution, 2 decimal places
-- temp_avg	- Average temperature. -40 to 125 Deg C, 12 bit resolution, 2 decimal places
-- humid_max	- Maximum humidity. 0 to 100 %RH, 8 bits resolution, 1 decimal place
-- humid_min	- Minimum humidity. 0 to 100 %RH, 8 bits resolution, 1 decimal place
-- humid_avg	- Average humidity. 0 to 100 %RH, 8 bits resolution, 1 decimal place
-- lux_max	- Maximum lux (illumination). 3 to 220k lux, 16 bit resolution, 0 decimal places
-- lux_min	- Minimum lux (illumination). 3 to 220k lux, 16 bit resolution, 0 decimal places
-- co_max	- Maximum CO level. 10 to 10,000 PPM
-- co_min	- Minimum CO level. 10 to 10,000 PPM
-- co_avg	- Average CO level. 10 to 10,000 PPM
-- co2_max	- Maximum CO2 level. 10 to 10,000 PPM
-- co2_min	- Minimum CO2 level. 10 to 10,000 PPM
-- co2_avg	- Average CO2 level. 10 to 10,000 PPM
-- pir_count	- Number of PIR events registered
-- rssi		- RSSI level, 0 - 100%
-- battery	- Battery charge level, 0 - 100%.
-- remote_ack	- Remote acknowledged smart controller ASEMP request
--		  0 = FALSE, 
--		  1 = TRUE (default).
-- ac_current	- AC Current measurement. 0 to 60 Ampere
--
CREATE TABLE `sensorsdyn` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `type_` int(11) NOT NULL DEFAULT 0,
  `device_id` int(11) NOT NULL,
  `temp_max` float(9, 3) DEFAULT NULL,
  `temp_min` float(9, 3) DEFAULT NULL,
  `temp_avg` float(9, 3) DEFAULT NULL,
  `humid_max` float(9, 3) DEFAULT NULL,
  `humid_min` float(9, 3) DEFAULT NULL,
  `humid_avg` float(9, 3) DEFAULT NULL,
  `lux_max` int(11) DEFAULT NULL,
  `lux_min` int(11) DEFAULT NULL,
  `co_max` int(11) DEFAULT NULL,
  `co_min` int(11) DEFAULT NULL,
  `co_avg` int(11) DEFAULT NULL,
  `co2_max` int(11) DEFAULT NULL,
  `co2_min` int(11) DEFAULT NULL,
  `co2_avg` int(11) DEFAULT NULL,
  `pir_count` int(11) DEFAULT NULL,
  `rssi` int(11) DEFAULT NULL,
  `battery` int(11) DEFAULT NULL,
  `remote_ack` int(11) DEFAULT NULL,
  `ac_current` float(9, 3) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table occupancy:
-- Where HVAC occupancy process stores results
--
-- id		- unique ID for reference
-- updated	- date and time of last occupancy status update
-- zone_id	- zone that became occupied or unoccupied
-- device_id	- device that have PIR sensor used to determine zone occupancy (optional)
-- status	- zone occupancy status:
--		  0 = not occupied (default)
--		  1 = fully occupied
--		  2 = extended occupancy status
--
CREATE TABLE `occupancy` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `zone_id` int(11) DEFAULT NULL,
  `device_id` int(11) DEFAULT NULL,
  `status` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table timers:
-- Storage for all internal timers
--
-- id		- unique ID for reference
-- updated	- date and time of timer set
-- expired	- date and time of timer expired
-- type_	- timer type:
--		  0 = old, expired or processed timer. must be ignored
--		  1 = motion detected last 30 minutes ago (for max saving mode)
--		  2 = motion detected last 60 minutes ago (for balanced mode)
--		  3 = motion detected last day (for auto away)
-- zone_id	- zone that timer designates (optional)
-- device_id	- device that timer designates (optional)
--
CREATE TABLE `timers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `updated` datetime DEFAULT NULL,
  `expired` datetime DEFAULT NULL,
  `type_` int(11) DEFAULT NULL,
  `zone_id` int(11) DEFAULT NULL,
  `device_id` int(11) DEFAULT NULL,
  PRIMARY KEY USING BTREE (id)
) ENGINE=MEMORY CHARACTER SET=UTF8;

-- Description of table zigbee_ase:
-- ASE Devices Table stores details of the all the known ASE devices in the network
-- 
-- id			- unique ID for reference
-- device_id		- ID that corresponds to the `devices` table which stored user-defined information like device description, zone assignment, etc
-- profile_id 		- ASEMP Profile ID connected to asemp table
-- joined		- Time at which this entry was added to this table
-- updated 		- Time when the last message was received from this ZED
-- device_type 		- Bitmapped field that shows combination of features:
--			  0x0001 = Temperature Sensor
--			  0x0002 = Humidity Sensor
--			  0x0004 = PIR Sensor
--			  0x0008 = Ambient Light Sensor
--			  0x0010 = CO Sensor
--			  0x0020 = CO2 Sensor
--			  0x0040 = Future Sensor
--			  0x0080 = Step motor
-- device_status 	- Device online status:
--			  0 = device off line (non responding to service discovery) 
--			  1 = device on-line 
--			  2 = device removed (disabled?)
-- device_state 	- Device operational state, controls if the mux/demux layer passes the data from ZED to upper layer:
--			  1 = ASE_ZED_ENABLED
--			  2 = ASE_ZED_DISABLED
-- addr64		- Mac address of remote zigbee radio
-- addr16		- remote Zigbee short address
-- zigbee_hw		- Zigbee radio hardware version
-- zigbee_sw		- Zigbee radio firmware version
-- device_sw		- Device software/firmware version 
--
CREATE TABLE `zigbee_ase` (
  id int(11) NOT NULL AUTO_INCREMENT,
  device_id int(11) DEFAULT NULL,
  profile_id int(11) DEFAULT NULL,
  joined datetime NOT NULL,
  updated datetime DEFAULT NULL,
  device_type int(11) NOT NULL DEFAULT 0,
  device_status tinyint(4) NOT NULL DEFAULT 0,
  device_state tinyint(4) NOT NULL DEFAULT 2,
  addr64 char(20) DEFAULT NULL,
  addr16 int(11) DEFAULT NULL,
  zigbee_hw int(11) DEFAULT NULL,
  zigbee_sw int(11) DEFAULT NULL,
  device_sw int(11) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table zigbee_ha:
-- All HA devices registered with the ZC which are not ASE are stored in this table
-- 
-- id			- unique ID for reference
-- device_id		- ID that corresponds to the `devices` table which stored user-defined information
-- cluster_id 		- Only actionable ClusterIDs. Currently supported:
--			  0x0006 = OnOff
--			  0x0702 = Smart Metering
-- endpoint_id 		- Any end point ID
-- profile_id 		- Zigbee profile ID - fixed for now 0x104
-- joined		- Time at which this entry was added to this table
-- updated 		- Time when the last message was received from this ZED
-- device_status 	- Device online status:
--			  0 = device off line (non responding to service discovery) 
--			  1 = device on-line 
--			  2 = device removed (disabled?)
-- addr64		- Mac address of remote zigbee radio
-- addr16		- remote Zigbee short address
--
CREATE TABLE `zigbee_ha` (
  id int(11) NOT NULL AUTO_INCREMENT,
  device_id int(11) DEFAULT NULL,
  cluster_id int(11) DEFAULT NULL,
  endpoint_id int(11) DEFAULT NULL,
  profile_id int(11) DEFAULT NULL,
  joined datetime NOT NULL,
  updated datetime DEFAULT NULL,
  device_status int(11) DEFAULT NULL,
  addr64 char(20) DEFAULT NULL,
  addr16 int(11) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Description of table zigbee_commands:
-- All HA devices registered with the ZC which are not ASE are stored in this table
-- 
-- id			- unique ID for reference
-- device_id		- ID that corresponds to the `devices` table
-- command		- Appropriate command must be placed. Supported commands:
--			  0x0006 = ACTION_ON
--			  0x0006 = ACTION_OFF ??
--			  0x0702 = ACTION_SMART_METER
-- updated 		- Time when the last message was received from this ZED
-- return_code		- Return is filled by the MuxDemux layer after taking action on the received command:
--			  0x00 = ASE_COMMAND_WAIT_TO_PROCESS - Filled value by upper layer and stays in this state for a very short period of time
--			  0x01 = ASE_COMMAND_PENDING - waiting for remote to reply
--			  0x02 = ASE_COMMAND_OK- Action is performed and completed successfully
--			  0x03 = ASE_COMMAND_FAILURE - command was sent but reply was not received with a timed out period
--			  0x04 = ASE_COMMAND_ERROR - command has an error - for example incorrect EndPointId, Command etc.
-- result_string	- Meaningful string to provide description to the status. Used only for WebUI to display and to pass any kinds of error conditions to the upper layer.
-- return_value		- Return value from the completion of the command. In Phase 1a Smart Metering request's return value is stored in the column.
--
CREATE TABLE `zigbee_commands` (
  id int(11) NOT NULL AUTO_INCREMENT,
  device_id int(11) NOT NULL,
  command int(11) NOT NULL,
  updated datetime NOT NULL,
  return_code int(11) DEFAULT NULL,
  result_string varchar(255) DEFAULT NULL,
  return_value int(11) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
